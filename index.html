<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JEE Physics Engine: 1D & 2D</title>
    <style>
        :root {
            --bg: #09090b;
            --panel: rgba(24, 24, 27, 0.9);
            --accent: #3b82f6;
            --accent-glow: rgba(59, 130, 246, 0.5);
            --text: #e4e4e7;
            --vector-x: #ef4444;
            --vector-y: #22c55e;
            --path: rgba(255, 255, 255, 0.3);
        }

        body {
            margin: 0;
            overflow: hidden;
            background: var(--bg);
            color: var(--text);
            font-family: 'Courier New', monospace; /* Coding/Technical vibe */
        }

        canvas {
            display: block;
            width: 100vw;
            height: 100vh;
        }

        /* HUD & Controls Overlay */
        #ui-layer {
            position: absolute;
            top: 20px;
            left: 20px;
            width: 300px;
            pointer-events: none; /* Let clicks pass through to canvas */
        }

        .panel {
            background: var(--panel);
            backdrop-filter: blur(10px);
            padding: 15px;
            border-radius: 8px;
            border-left: 3px solid var(--accent);
            pointer-events: auto;
            margin-bottom: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }

        h2 { margin: 0 0 10px 0; font-size: 1rem; text-transform: uppercase; letter-spacing: 2px; color: var(--accent); }
        
        .control-group { margin-bottom: 12px; }
        label { display: flex; justify-content: space-between; font-size: 0.8rem; margin-bottom: 4px; }
        
        input[type="range"] {
            width: 100%;
            height: 4px;
            background: #3f3f46;
            appearance: none;
            border-radius: 2px;
        }
        input[type="range"]::-webkit-slider-thumb {
            appearance: none;
            width: 16px;
            height: 16px;
            background: var(--accent);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 10px var(--accent);
        }

        .btn-row { display: flex; gap: 5px; margin-top: 10px; }
        button {
            flex: 1;
            background: #27272a;
            border: 1px solid #3f3f46;
            color: white;
            padding: 8px;
            cursor: pointer;
            font-family: inherit;
            font-size: 0.8rem;
            transition: all 0.2s;
        }
        button:hover { background: var(--accent); border-color: var(--accent); }
        button.active { background: var(--accent); font-weight: bold; box-shadow: 0 0 10px var(--accent-glow); }

        .stats { font-size: 0.75rem; color: #a1a1aa; line-height: 1.4; }
        .val-high { color: white; font-weight: bold; }

        /* Mode Selector */
        .mode-tabs {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
        }
    </style>
</head>
<body>

    <div class="mode-tabs">
        <button onclick="setMode('1D')" id="btn-1d" class="active">1D Motion</button>
        <button onclick="setMode('2D')" id="btn-2d">2D Projectile</button>
        <button onclick="setMode('REL')" id="btn-rel">Relative (Rain)</button>
    </div>

    <div id="ui-layer">
        <div class="panel">
            <h2>Simulation Config</h2>
            
            <div id="controls-container">
                </div>

            <div class="btn-row">
                <button onclick="resetSim()">RESET / FIRE</button>
                <button onclick="togglePause()" id="pause-btn">PAUSE</button>
            </div>
            <div class="btn-row">
                 <button onclick="toggleSlowMo()" id="slow-btn">SLOW MO</button>
                 <button onclick="toggleVectors()" id="vec-btn" class="active">VECTORS</button>
            </div>
        </div>

        <div class="panel">
            <h2>Live Data</h2>
            <div class="stats" id="stats-display">
                Waiting for launch...
            </div>
        </div>
    </div>

    <canvas id="simCanvas"></canvas>

<script>
/**
 * PHYSICS ENGINE CORE
 * Fairoosh's Custom Build
 */

const canvas = document.getElementById('simCanvas');
const ctx = canvas.getContext('2d');

// State
let width, height;
let animationId;
let lastTime = 0;
let isPaused = false;
let isSlowMo = false;
let showVectors = true;
let mode = '1D'; // '1D', '2D', 'REL' (Relative)

// Physics Constants
const PIXELS_PER_METER = 20; // Scale: 20px = 1 meter
let GRAVITY = 9.8; 
let TIME_STEP = 1/60;

// Simulation Objects
let particle = {
    x: 0, y: 0,
    vx: 0, vy: 0,
    radius: 10,
    color: '#3b82f6',
    trail: [],
    mass: 1,
    restitution: 0.7 // Bounciness
};

let rain = []; // For relative mode
let man = { x: 0, vx: 0 }; // For relative mode

// Config Inputs
let config = {
    u: 40,      // Initial Velocity
    theta: 45,  // Angle
    h: 100,     // Initial Height (1D)
    g: 9.8,     // Gravity
    rainAngle: 0, // Vertical
    manSpeed: 0
};

// --- INITIALIZATION ---

function resize() {
    width = canvas.width = window.innerWidth;
    height = canvas.height = window.innerHeight;
}
window.addEventListener('resize', resize);
resize();

function setMode(newMode) {
    mode = newMode;
    document.querySelectorAll('.mode-tabs button').forEach(b => b.classList.remove('active'));
    document.getElementById(`btn-${newMode.toLowerCase()}`).classList.add('active');
    updateControlsUI();
    resetSim();
}

function updateControlsUI() {
    const container = document.getElementById('controls-container');
    let html = '';

    if (mode === '1D') {
        html += createSlider('Height (m)', 'h', 0, 300, config.h);
        html += createSlider('Gravity (m/s²)', 'g', 1, 20, config.g);
        html += createSlider('Bounciness', 'res', 0, 1, particle.restitution, 0.1);
    } else if (mode === '2D') {
        html += createSlider('Velocity (m/s)', 'u', 10, 100, config.u);
        html += createSlider('Angle (deg)', 'theta', 0, 90, config.theta);
        html += createSlider('Gravity', 'g', 1, 20, config.g);
    } else if (mode === 'REL') {
        html += createSlider('Man Speed (m/s)', 'manSpeed', -20, 20, config.manSpeed);
        html += createSlider('Rain Vertical Speed', 'u', 5, 50, 20); // Reusing u for rain speed
        html += '<p style="font-size:0.8rem; color:#666">Goal: Adjust Man Speed to see rain fall vertically relative to him.</p>';
    }

    container.innerHTML = html;
}

function createSlider(label, key, min, max, val, step=1) {
    return `
        <div class="control-group">
            <label>${label} <span id="val-${key}">${val}</span></label>
            <input type="range" min="${min}" max="${max}" value="${val}" step="${step}" 
            oninput="updateConfig('${key}', this.value)">
        </div>
    `;
}

function updateConfig(key, value) {
    value = parseFloat(value);
    document.getElementById(`val-${key}`).innerText = value;
    
    if(key === 'res') particle.restitution = value;
    else config[key] = value;

    if (mode === 'REL') resetSim(); // Instant update for rain
}

function resetSim() {
    GRAVITY = config.g;
    particle.trail = [];
    
    if (mode === '1D') {
        particle.x = width / 2;
        particle.y = height - (config.h * PIXELS_PER_METER) - 20; // Ground offset
        particle.vx = 0;
        particle.vy = 0;
    } else if (mode === '2D') {
        particle.x = 50;
        particle.y = height - 50;
        const rad = config.theta * (Math.PI / 180);
        particle.vx = config.u * Math.cos(rad);
        particle.vy = -config.u * Math.sin(rad); // Negative is UP in Canvas
    } else if (mode === 'REL') {
        man.x = width/2;
        man.vx = config.manSpeed;
        rain = [];
        // Spawn drops
        for(let i=0; i<50; i++) {
            rain.push({
                x: Math.random() * width,
                y: Math.random() * height,
                vy: config.u
            });
        }
    }
}

// --- PHYSICS LOOP ---

function update(dt) {
    if (isPaused) return;
    
    // Time scaling
    const simDt = isSlowMo ? dt * 0.2 : dt;

    if (mode === '1D') {
        // Gravity
        particle.vy += GRAVITY * PIXELS_PER_METER * simDt;
        particle.y += particle.vy * simDt;

        // Ground Collision
        if (particle.y + particle.radius > height) {
            particle.y = height - particle.radius;
            particle.vy *= -particle.restitution;
            
            // Stop micro-bouncing
            if (Math.abs(particle.vy) < 20) particle.vy = 0;
        }

    } else if (mode === '2D') {
        // Gravity only affects Y
        particle.vy += GRAVITY * PIXELS_PER_METER * simDt;
        
        particle.x += particle.vx * simDt * PIXELS_PER_METER; // Note: scaling X to match meters
        particle.y += particle.vy * simDt; // scaling Y happened in gravity

        // Trail Logic
        if (frameCounter % 5 === 0) {
            particle.trail.push({x: particle.x, y: particle.y});
            if (particle.trail.length > 50) particle.trail.shift();
        }

        // Floor collision (Stop sim)
        if (particle.y + particle.radius > height) {
            particle.y = height - particle.radius;
            particle.vx = 0;
            particle.vy = 0;
        }
    } else if (mode === 'REL') {
        man.vx = config.manSpeed;
        
        // Update rain
        rain.forEach(drop => {
            drop.y += drop.vy * PIXELS_PER_METER * simDt;
            drop.x -= man.vx * PIXELS_PER_METER * simDt; // Relative X motion

            if (drop.y > height) {
                drop.y = 0;
                drop.x = Math.random() * width;
            }
            if (drop.x < 0) drop.x = width;
            if (drop.x > width) drop.x = 0;
        });
    }
}

// --- RENDERING ---

let frameCounter = 0;

function draw() {
    ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--bg');
    ctx.fillRect(0, 0, width, height);
    
    // Draw Grid
    drawGrid();

    if (mode === '1D' || mode === '2D') {
        // Draw Trail
        if (mode === '2D') {
            ctx.beginPath();
            ctx.strokeStyle = 'rgba(255,255,255,0.2)';
            ctx.lineWidth = 2;
            particle.trail.forEach((p, i) => {
                if(i===0) ctx.moveTo(p.x, p.y);
                else ctx.lineTo(p.x, p.y);
            });
            ctx.stroke();
        }

        // Draw Ball
        ctx.beginPath();
        ctx.arc(particle.x, particle.y, particle.radius, 0, Math.PI * 2);
        ctx.fillStyle = particle.color;
        ctx.shadowBlur = 15;
        ctx.shadowColor = particle.color;
        ctx.fill();
        ctx.shadowBlur = 0;
        ctx.closePath();

        // Draw Vectors
        if (showVectors) drawVectors();
        
        updateStats();
    } else if (mode === 'REL') {
        drawRainSim();
    }

    frameCounter++;
}

function drawGrid() {
    ctx.strokeStyle = '#1e1e20';
    ctx.lineWidth = 1;
    const size = PIXELS_PER_METER * 5; // 5 meter grid
    
    // Draw ground line
    ctx.beginPath();
    ctx.strokeStyle = '#3f3f46';
    ctx.lineWidth = 2;
    ctx.moveTo(0, height);
    ctx.lineTo(width, height);
    ctx.stroke();
}

function drawVectors() {
    const scale = 0.5; // Scale down vector visual length
    
    // Velocity Y (Green)
    drawArrow(particle.x, particle.y, particle.x, particle.y + particle.vy * scale, '#22c55e');
    
    // Velocity X (Red) - Only for 2D
    if (mode === '2D') {
        drawArrow(particle.x, particle.y, particle.x + (particle.vx * PIXELS_PER_METER * scale), particle.y, '#ef4444');
    }
}

function drawArrow(fromx, fromy, tox, toy, color) {
    const headlen = 10;
    const dx = tox - fromx;
    const dy = toy - fromy;
    const angle = Math.atan2(dy, dx);
    
    ctx.strokeStyle = color;
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(fromx, fromy);
    ctx.lineTo(tox, toy);
    ctx.lineTo(tox - headlen * Math.cos(angle - Math.PI / 6), toy - headlen * Math.sin(angle - Math.PI / 6));
    ctx.moveTo(tox, toy);
    ctx.lineTo(tox - headlen * Math.cos(angle + Math.PI / 6), toy - headlen * Math.sin(angle + Math.PI / 6));
    ctx.stroke();
}

function drawRainSim() {
    // Draw Man
    ctx.fillStyle = '#3b82f6';
    ctx.fillRect(width/2 - 10, height - 60, 20, 60);
    
    // Draw Rain
    ctx.strokeStyle = '#60a5fa';
    ctx.lineWidth = 2;
    rain.forEach(r => {
        ctx.beginPath();
        // Rain is falling down (positive y), but looks slanted due to relative x
        const slant = -man.vx * 2; 
        ctx.moveTo(r.x, r.y);
        ctx.lineTo(r.x + slant, r.y + 15);
        ctx.stroke();
    });

    // Umbrella Vector
    const rainVel = config.u;
    const manVel = config.manSpeed;
    const angle = Math.atan2(manVel, rainVel) * (180/Math.PI);
    
    document.getElementById('stats-display').innerHTML = `
        <span class="val-high">RELATIVE VELOCITY:</span><br>
        V_rain_ground = ${rainVel} m/s (Down)<br>
        V_man = ${manVel} m/s <br>
        <strong>Umbrella Angle needed: ${Math.abs(angle.toFixed(1))}° with Vertical</strong>
    `;
}

function updateStats() {
    // Convert px/s back to m/s for display
    const vy = -(particle.vy / PIXELS_PER_METER).toFixed(1); // Negate because Up is -Y in canvas
    const vx = particle.vx.toFixed(1);
    const h = ((height - particle.y - particle.radius) / PIXELS_PER_METER).toFixed(1);
    
    let html = `
        <span style="color:#22c55e">Vy: ${vy} m/s</span><br>
        <span style="color:#ef4444">Vx: ${vx} m/s</span><br>
        Height: ${h} m
    `;
    
    if (mode === '2D') {
        const v_net = Math.sqrt(vx*vx + vy*vy).toFixed(1);
        html += `<br>V_net: ${v_net} m/s`;
    }

    document.getElementById('stats-display').innerHTML = html;
}

// --- LOOP CONTROL ---

function loop(timestamp) {
    const dt = (timestamp - lastTime) / 1000;
    lastTime = timestamp;
    
    update(dt);
    draw();
    
    animationId = requestAnimationFrame(loop);
}

// Button Helpers
function togglePause() {
    isPaused = !isPaused;
    document.getElementById('pause-btn').classList.toggle('active');
}
function toggleSlowMo() {
    isSlowMo = !isSlowMo;
    document.getElementById('slow-btn').classList.toggle('active');
}
function toggleVectors() {
    showVectors = !showVectors;
    document.getElementById('vec-btn').classList.toggle('active');
}

// Start
setMode('1D'); // Default
updateControlsUI();
requestAnimationFrame(loop);

</script>
</body>
</html>
