<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Newtonian Lab Pro v3.0 | Surface Edition</title>
    <style>
        :root {
            --bg: #0f172a;
            --panel: rgba(15, 23, 42, 0.95);
            --primary: #38bdf8; /* Cyan */
            --accent: #f472b6; /* Pink */
            --floor: #1e293b;
            --text-main: #e2e8f0;
            --border: #334155;
        }

        body {
            margin: 0;
            overflow: hidden;
            background-color: var(--bg);
            color: var(--text-main);
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            user-select: none;
        }

        canvas {
            display: block;
            width: 100vw;
            height: 100vh;
        }

        /* UI OVERLAY */
        #ui {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            display: flex;
            justify-content: space-between;
            padding: 20px;
            box-sizing: border-box;
        }

        /* PANELS */
        .panel {
            background: var(--panel);
            backdrop-filter: blur(12px);
            border: 1px solid var(--border);
            padding: 20px;
            border-radius: 12px;
            width: 320px;
            pointer-events: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        /* Mobile adjustments for panel */
        @media (max-width: 768px) {
            .panel {
                width: 260px;
                padding: 15px;
                max-height: 60vh;
            }
            #ui { padding: 10px; flex-direction: column; gap: 10px; }
            .panel:last-child { 
                position: absolute; 
                bottom: 80px; /* Above the floor */
                right: 10px; 
                width: auto;
            }
        }

        h2 { margin: 0; font-size: 1rem; color: var(--primary); text-transform: uppercase; letter-spacing: 1px; }
        
        /* CONTROLS */
        .control-group { display: flex; flex-direction: column; gap: 5px; }
        .label-row { display: flex; justify-content: space-between; font-size: 0.8rem; color: #94a3b8; }
        .value-display { color: var(--primary); font-weight: bold; font-family: monospace; }

        input[type="range"] {
            -webkit-appearance: none; width: 100%; height: 4px; background: var(--border); border-radius: 2px; outline: none;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none; width: 16px; height: 16px; background: var(--text-main); border-radius: 50%; cursor: pointer; border: 2px solid var(--primary);
        }

        .btn-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        button {
            background: #1e293b; border: 1px solid var(--border); color: var(--text-main); padding: 10px;
            border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 0.75rem; text-transform: uppercase;
        }
        button.active { background: var(--primary); color: #0f172a; border-color: var(--primary); }
        button.fire-btn {
            background: linear-gradient(135deg, var(--primary), #2563eb); color: white; border: none; grid-column: span 2; padding: 12px; font-size: 0.9rem;
        }

        /* STATS */
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; font-family: monospace; font-size: 0.85rem; }
        .stat-box { background: rgba(0,0,0,0.3); padding: 6px; border-radius: 4px; border-left: 2px solid #555; }
        .stat-val { display: block; font-size: 1.1em; font-weight: bold; color: white; }
        
        #hit-message {
            position: absolute; top: 40%; left: 50%; transform: translate(-50%, -50%);
            font-size: 2.5rem; font-weight: 900; color: #4ade80; opacity: 0; pointer-events: none;
            text-shadow: 0 0 20px #4ade80; transition: opacity 0.3s;
        }
    </style>
</head>
<body>

    <div id="hit-message">TARGET HIT!</div>
    <canvas id="simCanvas"></canvas>

    <div id="ui">
        <div class="panel">
            <div class="label-row" style="margin-bottom:5px;"><span>NEWTON LAB v3.0</span> <span>SURFACE ED.</span></div>
            
            <div class="btn-grid">
                <button id="btn-1d" onclick="setMode('1D')">1D Drop</button>
                <button id="btn-2d" class="active" onclick="setMode('2D')">2D Projectile</button>
            </div>

            <div class="control-group">
                <div class="label-row"><span>Velocity ($u$)</span> <span id="disp-u" class="value-display">45 m/s</span></div>
                <input type="range" min="5" max="100" value="45" oninput="updateVal('u', this.value)">
            </div>

            <div class="control-group" id="group-angle">
                <div class="label-row"><span>Angle ($\theta$)</span> <span id="disp-theta" class="value-display">45°</span></div>
                <input type="range" id="input-theta" min="0" max="90" value="45" oninput="updateVal('theta', this.value)">
            </div>

            <div class="control-group">
                <div class="label-row"><span>Gravity ($g$)</span> <span id="disp-g" class="value-display">9.8 m/s²</span></div>
                <input type="range" min="1" max="25" value="9.8" step="0.1" oninput="updateVal('g', this.value)">
            </div>
            
            <div class="control-group">
                 <div class="label-row"><span>Time Scale</span> <span id="disp-time" class="value-display">1.0x</span></div>
                 <input type="range" min="0.1" max="2.0" step="0.1" value="1.0" oninput="timeScale = parseFloat(this.value); document.getElementById('disp-time').innerText = this.value + 'x'">
            </div>

            <div class="btn-grid">
                <button onclick="clearTrails()">Clear</button>
                <button onclick="resetSim()">Reset</button>
            </div>
            <button class="fire-btn" onclick="fire()">LAUNCH</button>
        </div>

        <div class="panel" style="height: fit-content;">
            <h2>Telemetry</h2>
            <div class="stats-grid">
                <div class="stat-box" style="border-color: #ef4444;">
                    <span class="stat-val" id="stat-vx">0.0</span> <span style="color:#888">Vx</span>
                </div>
                <div class="stat-box" style="border-color: #22c55e;">
                    <span class="stat-val" id="stat-vy">0.0</span> <span style="color:#888">Vy</span>
                </div>
                <div class="stat-box" style="border-color: #eab308;">
                    <span class="stat-val" id="stat-h">0.0</span> <span style="color:#888">Height</span>
                </div>
                <div class="stat-box" style="border-color: #3b82f6;">
                    <span class="stat-val" id="stat-r">0.0</span> <span style="color:#888">Range</span>
                </div>
            </div>
            <div style="font-size:0.75rem; color:#64748b; margin-top:10px;">
                * Drag the Pink Target to move it.<br>
                * Floor markers every 10 meters.
            </div>
        </div>
    </div>

<script>
const canvas = document.getElementById('simCanvas');
const ctx = canvas.getContext('2d');

// --- CONFIG ---
const SCALE = 15; // 15px = 1 meter
const FLOOR_HEIGHT = 80; // The visible surface height
let width, height, groundY;

// Physics State
let particles = [];
let activeId = -1;
let mode = '2D';
let timeScale = 1.0;
let isDraggingTarget = false;

let params = { u: 45, theta: 45, g: 9.8, bounce: 0.6 };
let target = { x: 500, y: 0, radius: 25 }; // y set in resize

// --- INIT ---
function resize() {
    width = canvas.width = window.innerWidth;
    height = canvas.height = window.innerHeight;
    groundY = height - FLOOR_HEIGHT; // The actual physics ground level
    
    // Default target pos if not set
    if(target.y === 0) {
        target.x = width * 0.7;
        target.y = groundY;
    }
}
window.addEventListener('resize', resize);
resize();

// --- CONTROLS ---
function updateVal(key, val) {
    val = parseFloat(val);
    if(key === 'u') { params.u = val; document.getElementById('disp-u').innerText = val + ' m/s'; }
    if(key === 'theta') { params.theta = val; document.getElementById('disp-theta').innerText = val + '°'; }
    if(key === 'g') { params.g = val; document.getElementById('disp-g').innerText = val + ' m/s²'; }
}

function setMode(m) {
    mode = m;
    document.getElementById('btn-1d').className = mode === '1D' ? 'active' : '';
    document.getElementById('btn-2d').className = mode === '2D' ? 'active' : '';
    
    const angleRow = document.getElementById('group-angle');
    if (mode === '1D') {
        angleRow.style.opacity = '0.5'; angleRow.style.pointerEvents = 'none';
        params.theta = 90; document.getElementById('disp-theta').innerText = "90°";
    } else {
        angleRow.style.opacity = '1'; angleRow.style.pointerEvents = 'auto';
        params.theta = parseFloat(document.getElementById('input-theta').value);
        document.getElementById('disp-theta').innerText = params.theta + "°";
    }
    clearTrails();
}

// --- PHYSICS CLASS ---
class Particle {
    constructor(u, theta, isGhost = false) {
        this.rad = 10;
        this.x = 40; 
        this.y = groundY - this.rad - 2; // Start just above floor
        
        const rad = theta * (Math.PI / 180);
        this.vx = u * Math.cos(rad);
        this.vy = -u * Math.sin(rad); 
        
        this.active = true;
        this.isGhost = isGhost;
        this.trail = [];
        this.color = isGhost ? 'rgba(255, 255, 255, 0.15)' : '#38bdf8';
        this.startX = this.x;
    }

    update(dt) {
        if (!this.active) return;

        // Gravity
        this.vy += params.g * SCALE * dt;
        
        // Move
        this.x += this.vx * SCALE * dt;
        this.y += this.vy * SCALE * dt;

        // Floor Collision
        if (this.y + this.rad > groundY) {
            this.y = groundY - this.rad;
            this.vy *= -params.bounce;
            this.vx *= 0.9; // Friction
            
            if (Math.abs(this.vy) < 20) this.vy = 0;
            if (Math.abs(this.vx) < 5) { this.vx = 0; this.active = false; }
        }

        // Walls
        if (this.x > width) this.active = false;

        // Trail
        if (this.active) {
            this.trail.push({x: this.x, y: this.y});
            if (this.trail.length > 200) this.trail.shift();
        }

        // Target Check
        if (!this.isGhost) {
            const dx = this.x - target.x;
            const dy = this.y - target.y; // target y is center, careful with ground
            // target sits on ground usually, let's treat target.y as its center
            if (Math.hypot(dx, dy) < this.rad + target.radius) {
                showHit();
            }
        }
    }

    draw() {
        // Trail
        if (this.trail.length > 1) {
            ctx.beginPath();
            ctx.strokeStyle = this.isGhost ? this.color : `rgba(56, 189, 248, 0.6)`;
            ctx.lineWidth = this.isGhost ? 1 : 3;
            for (let i=0; i<this.trail.length; i++) ctx.lineTo(this.trail[i].x, this.trail[i].y);
            ctx.stroke();
        }
        // Ball
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.rad, 0, Math.PI*2);
        ctx.fillStyle = this.active ? this.color : '#555';
        ctx.shadowBlur = this.isGhost ? 0 : 10;
        ctx.shadowColor = this.color;
        ctx.fill();
        ctx.shadowBlur = 0;
    }
}

// --- RENDER HELPERS ---
function drawFloor() {
    // Surface Block
    ctx.fillStyle = '#1e293b'; 
    ctx.fillRect(0, groundY, width, FLOOR_HEIGHT);
    
    // Neon Top Edge
    ctx.beginPath();
    ctx.moveTo(0, groundY);
    ctx.lineTo(width, groundY);
    ctx.strokeStyle = '#38bdf8';
    ctx.lineWidth = 2;
    ctx.shadowBlur = 10;
    ctx.shadowColor = '#38bdf8';
    ctx.stroke();
    ctx.shadowBlur = 0;

    // Measurements (Ruler)
    ctx.fillStyle = '#64748b';
    ctx.font = '10px monospace';
    ctx.textAlign = 'center';
    
    let startX = 40; // particle start x
    
    // Draw ticks every 10 meters
    for (let m = 0; m < 200; m += 10) { // up to 2000m roughly
        let px = startX + (m * SCALE);
        if (px > width) break;
        
        // Tick line
        ctx.fillRect(px, groundY, 2, 10);
        
        // Number
        if (m > 0) ctx.fillText(m + 'm', px, groundY + 22);
    }
}

function drawTarget() {
    ctx.beginPath();
    // If target is dragged, use mouse pos, else snap to floor for aesthetics
    let drawY = isDraggingTarget ? target.y : Math.min(target.y, groundY - target.radius);
    target.y = drawY; // keep updated

    ctx.arc(target.x, target.y, target.radius, 0, Math.PI*2);
    ctx.fillStyle = 'rgba(244, 114, 182, 0.2)';
    ctx.fill();
    ctx.strokeStyle = '#f472b6';
    ctx.lineWidth = 2;
    ctx.setLineDash([4, 4]);
    ctx.stroke();
    ctx.setLineDash([]);
    
    // Bullseye
    ctx.beginPath();
    ctx.arc(target.x, target.y, 4, 0, Math.PI*2);
    ctx.fillStyle = '#f472b6';
    ctx.fill();
}

// --- CORE LOOPS ---
function fire() {
    if (particles.length > 0) {
        let old = particles[particles.length - 1];
        old.isGhost = true; old.active = false; old.color = 'rgba(255,255,255,0.1)';
    }
    particles.push(new Particle(params.u, params.theta));
    activeId = particles.length - 1;
}

function clearTrails() { particles = []; activeId = -1; resetStats(); }
function resetSim() { clearTrails(); target.x = width*0.7; }
function resetStats() {
    ['vx','vy','h','r'].forEach(id => document.getElementById('stat-'+id).innerText = "0.0");
}
function showHit() {
    const msg = document.getElementById('hit-message');
    msg.style.opacity = '1'; msg.style.transform = 'translate(-50%,-50%) scale(1.2)';
    setTimeout(() => { msg.style.opacity = '0'; msg.style.transform = 'translate(-50%,-50%) scale(1)'; }, 1000);
}

// Interaction
canvas.addEventListener('mousedown', e => {
    const rect = canvas.getBoundingClientRect();
    const d = Math.hypot(e.clientX - rect.left - target.x, e.clientY - rect.top - target.y);
    if(d < target.radius + 15) isDraggingTarget = true;
});
canvas.addEventListener('mousemove', e => {
    if(isDraggingTarget) {
        const rect = canvas.getBoundingClientRect();
        target.x = e.clientX - rect.left;
        target.y = e.clientY - rect.top;
    }
});
canvas.addEventListener('mouseup', () => isDraggingTarget = false);

// Anim Loop
let lastTime = 0;
function animate(timestamp) {
    const dt = (timestamp - lastTime) / 1000;
    lastTime = timestamp;

    ctx.fillStyle = getComputedStyle(document.body).getPropertyValue('--bg');
    ctx.fillRect(0, 0, width, height);

    drawFloor();
    drawTarget();

    particles.forEach(p => {
        p.update(dt * timeScale);
        p.draw();
    });

    if (activeId !== -1 && particles[activeId]) {
        const p = particles[activeId];
        document.getElementById('stat-vx').innerText = p.vx.toFixed(1);
        document.getElementById('stat-vy').innerText = (-p.vy).toFixed(1);
        document.getElementById('stat-h').innerText = Math.max(0, (groundY - p.y - p.rad)/SCALE).toFixed(1);
        document.getElementById('stat-r').innerText = ((p.x - 40)/SCALE).toFixed(1);
    }

    requestAnimationFrame(animate);
}
requestAnimationFrame(animate);

</script>
</body>
</html>
